<div class="selection">
  <form *ngIf="count >= 0">
    <mat-form-field appearance="fill" class="url">
      <mat-label>Ссылка на получателя</mat-label>
      <input matInput placeholder="https://vk.com/xxxxxxxxxxxx" [formControl]="userUrl" required />
      <mat-icon matPrefix>link</mat-icon>
      <mat-error *ngIf="userUrl.invalid && (userUrl.dirty || userUrl.touched)">{{
        getErrorMessage()
      }}</mat-error>
    </mat-form-field>
    <button mat-raised-button color="primary" class="select" (click)="select()">Поиск</button>
  </form>

  <table
    mat-table
    [dataSource]="products"
    class="table"
    *ngIf="products.length > 0 && count === -1"
  >
    <ng-container matColumnDef="id">
      <th *matHeaderCellDef mat-header-cell>ID</th>
      <td *matCellDef="let row" mat-cell>{{ _c(row).id }}</td>
    </ng-container>

    <ng-container matColumnDef="name">
      <th *matHeaderCellDef mat-header-cell>Название</th>
      <td *matCellDef="let row" mat-cell>{{ _c(row).name }}</td>
    </ng-container>

    <ng-container matColumnDef="description">
      <th *matHeaderCellDef mat-header-cell>Описание</th>
      <td *matCellDef="let row" mat-cell>{{ _c(row).description }}</td>
    </ng-container>

    <ng-container matColumnDef="price">
      <th *matHeaderCellDef mat-header-cell>Цена</th>
      <td *matCellDef="let row" mat-cell>{{ _c(row).price }}</td>
    </ng-container>

    <ng-container matColumnDef="catalogUrl">
      <th *matHeaderCellDef mat-header-cell>Ссылка на каталог</th>
      <td *matCellDef="let row" mat-cell>{{ _c(row).catalogUrl }}</td>
    </ng-container>

    <ng-container matColumnDef="function">
      <th mat-header-cell *matHeaderCellDef>Выбрать</th>
      <td mat-cell *matCellDef="let row">
        <mat-checkbox
          (click)="$event.stopPropagation(); selectProduct(_c(row), selection.isSelected(row))"
          (change)="$event ? selection.toggle(row) : null"
          [checked]="selection.isSelected(row)"
          color="primary"
        >
        </mat-checkbox>
      </td>
    </ng-container>

    <tr *matHeaderRowDef="columns" mat-header-row></tr>
    <tr *matRowDef="let row; columns: columns" mat-row></tr>
  </table>

  <mat-spinner
    *ngIf="products.length === 0 && count === -1"
    mode="indeterminate"
    class="spinner"
  ></mat-spinner>
  <button
    mat-raised-button
    color="primary"
    class="save"
    *ngIf="products.length > 0 && count === -1"
    (click)="save()"
  >
    Сохранить
  </button>
</div>
